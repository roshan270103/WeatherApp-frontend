@page "/register"
@inject HttpClient Http
@inject NavigationManager NavigationManager

<div class="auth-wrapper">
    <div class="auth-card">

        <h2>Create Account ✨</h2>
        <p class="auth-subtitle">Join and personalize your weather experience</p>

        <input class="auth-input" @bind="email" placeholder="Email" />
        <input class="auth-input" @bind="password" type="password" placeholder="Password" />
        <input class="auth-input" @bind="confirmPassword" type="password" placeholder="Confirm Password" />

        <button class="auth-btn" @onclick="RegisterUser">Register</button>

        @if (!string.IsNullOrEmpty(message))
        {
            <p style="margin-top:15px; color:#fff;">@message</p>
        }
    </div>
</div>

@code {
    private string email = "";
    private string password = "";
    private string confirmPassword = "";
    private string message = "";

    private async Task RegisterUser()
    {
        if (password != confirmPassword)
        {
            message = "❌ Passwords do not match";
            return;
        }

        var user = new { email = email, password = password };
        var response = await Http.PostAsJsonAsync(
            "https://weatherbackendapi-fbceb0brdmdqgmca.southindia-01.azurewebsites.net/api/user/register",
            user
        );

        if (response.IsSuccessStatusCode)
        {
            message = "✅ Registration successful! Check your email. Redirecting...";
            await Task.Delay(2500);
            NavigationManager.NavigateTo("/login");
        }
        else
        {
            var error = await response.Content.ReadAsStringAsync();
            message = $"❌ Registration failed: {error}";
        }
    }
}
